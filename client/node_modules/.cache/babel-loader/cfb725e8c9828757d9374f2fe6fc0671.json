{"ast":null,"code":"import _classCallCheck from \"/Users/wpereyra/Documents/Universidad/PP1/look_app_fe/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/wpereyra/Documents/Universidad/PP1/look_app_fe/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/wpereyra/Documents/Universidad/PP1/look_app_fe/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/wpereyra/Documents/Universidad/PP1/look_app_fe/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/wpereyra/Documents/Universidad/PP1/look_app_fe/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _assertThisInitialized from \"/Users/wpereyra/Documents/Universidad/PP1/look_app_fe/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\n\nvar _class,\n    _jsxFileName = \"/Users/wpereyra/Documents/Universidad/PP1/look_app_fe/src/components/Payments/PaymentModal.jsx\";\n\nimport React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport moment from 'moment';\nimport { withToastManager } from 'react-toast-notifications';\nimport { Modal, ModalHeader, ModalContent, ModalFooter, Title, Button, Text, Panel } from 'shipnow-mercurio';\nimport { Level, LevelLeft, LevelRight, Columns, Column } from 'bloomer';\nimport { faTimes } from \"@fortawesome/free-solid-svg-icons\";\nimport { PaymentForm } from './';\nimport FontAwesomeIcon from \"@fortawesome/react-fontawesome\";\nimport { withStore } from '../../hocs';\nimport { ConfirmationModal } from '../ConfirmationModal';\nimport { observer } from 'mobx-react';\nimport { translate } from '../../lib/Translator';\nimport { ReactComponent as SvgDraw } from \"@svgr/webpack?-prettier,-svgo!../../assets/undraw_Savings_dwkw.svg\";\n\nvar PaymentsModal = observer(_class =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(PaymentsModal, _Component);\n\n  function PaymentsModal(props) {\n    var _this;\n\n    _classCallCheck(this, PaymentsModal);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(PaymentsModal).call(this, props));\n    _this.state = {\n      confirmation: false,\n      appointment: _this.props.appointment,\n      paymentType: '',\n      cash: null,\n      points: null,\n      validCash: false,\n      validPoints: false,\n      validCashAndPoints: false,\n      invalidMsg: '',\n      confirmationData: {\n        accept: null,\n        cancel: null,\n        title: null,\n        content: null\n      }\n    };\n    _this.handleConfirm = _this.handleConfirm.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    _this.handleCancelConfirm = _this.handleCancelConfirm.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    _this.handlePay = _this.handlePay.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    _this.handlePaymentData = _this.handlePaymentData.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    return _this;\n  }\n\n  _createClass(PaymentsModal, [{\n    key: \"handlePay\",\n    value: function handlePay(name) {\n      var _this2 = this;\n\n      if (name == 'cancelled') {\n        this.props.onPay && this.props.onPay('cancelled');\n      } else if (this.state.paymentType == 'loaned') {\n        this.state.appointment.loan().then(function (response) {\n          _this2.props.onPay && _this2.props.onPay('paid', response);\n        });\n      } else {\n        this.state.appointment.pay(this.state.cash, this.state.points).then(function (response) {\n          _this2.props.onPay && _this2.props.onPay('paid', response);\n        });\n      }\n    }\n  }, {\n    key: \"handlePaymentData\",\n    value: function handlePaymentData(sender, value, name, valid, message) {\n      if (name == 'cash') {\n        valid && valid.type == 'success' ? this.setState({\n          cash: value,\n          points: null,\n          paymentType: 'cash',\n          validCash: true\n        }) : this.setState({\n          paymentType: 'cash',\n          validCash: false,\n          invalidMsg: message\n        });\n      }\n\n      if (name == 'points') {\n        valid && valid.type == 'success' ? this.setState({\n          points: value,\n          cash: null,\n          paymentType: 'points',\n          validPoints: true\n        }) : this.setState({\n          paymentType: 'points',\n          validPoints: false,\n          invalidMsg: message\n        });\n      }\n\n      if (name == 'cashHalf') {\n        valid ? this.setState({\n          cash: value,\n          paymentType: 'cashAndPoints',\n          validCashAndPoints: valid\n        }) : this.setState({\n          paymentType: 'cashAndPoints',\n          validCashAndPoints: false,\n          invalidMsg: message\n        });\n      }\n\n      if (name == 'pointsHalf') {\n        valid ? this.setState({\n          points: value,\n          paymentType: 'cashAndPoints',\n          validCashAndPoints: valid\n        }) : this.setState({\n          paymentType: 'cashAndPoints',\n          validCashAndPoints: false,\n          invalidMsg: message\n        });\n      }\n\n      if (name == 'loaned') {\n        this.setState({\n          points: null,\n          cash: null,\n          paymentType: 'loaned'\n        });\n      }\n    }\n  }, {\n    key: \"handleCancelConfirm\",\n    value: function handleCancelConfirm() {\n      this.setState({\n        confirmation: false\n      });\n    }\n  }, {\n    key: \"handleConfirm\",\n    value: function handleConfirm() {\n      var data = {};\n      data['title'] = this.getText('Abonar turno');\n      data['accept'] = this.handlePay;\n      data['cancel'] = this.handleCancelConfirm;\n      data['content'] = this.getText('Estás por efectuar el pago. ¿Estás seguro?');\n      this.setState({\n        confirmation: true,\n        confirmationData: data\n      });\n    }\n  }, {\n    key: \"renderConfirmationModal\",\n    value: function renderConfirmationModal() {\n      var confirmationData = this.state.confirmationData;\n      return React.createElement(ConfirmationModal, {\n        title: confirmationData.title,\n        content: confirmationData.content,\n        onAccept: confirmationData.accept,\n        onCancel: confirmationData.cancel,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 124\n        },\n        __self: this\n      });\n    }\n  }, {\n    key: \"getDisabled\",\n    value: function getDisabled() {\n      if (this.state.paymentType == 'cash') {\n        return !this.state.validCash;\n      }\n\n      if (this.state.paymentType == 'points') {\n        return !this.state.validPoints;\n      }\n\n      if (this.state.paymentType == 'cashAndPoints') {\n        return !this.state.validCashAndPoints;\n      }\n\n      if (this.state.paymentType == 'loaned') {\n        return false;\n      } else {\n        return true;\n      }\n    }\n  }, {\n    key: \"isValidPayment\",\n    value: function isValidPayment() {\n      if (this.state.paymentType == 'cashAndPoints') {\n        return this.state.validCashAndPoints;\n      }\n\n      if (this.state.paymentType == 'cash') {\n        return this.state.validCash;\n      }\n\n      if (this.state.paymentType == 'points') {\n        return this.state.validPoints;\n      } else {\n        return true;\n      }\n    }\n  }, {\n    key: \"getText\",\n    value: function getText(text) {\n      return translate(text, this.props.store.ui.language);\n    }\n  }, {\n    key: \"renderPartial\",\n    value: function renderPartial() {\n      var appointment = this.state.appointment;\n\n      if (appointment.payments.length > 0) {\n        var paid = 0;\n        appointment.payments.forEach(function (payment) {\n          paid += parseFloat(payment.amount);\n        });\n        return React.createElement(Title, {\n          size: \"md\",\n          className: \"mt-1 mb-1\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 174\n          },\n          __self: this\n        }, \"\".concat(this.getText('Total abonado: $'), \" \").concat(paid));\n      }\n\n      return null;\n    }\n  }, {\n    key: \"renderPending\",\n    value: function renderPending() {\n      var appointment = this.state.appointment;\n\n      if (appointment.payments.length > 0) {\n        var paid = 0;\n        appointment.payments.forEach(function (payment) {\n          paid += parseFloat(payment.amount);\n        });\n        return React.createElement(Title, {\n          size: \"md\",\n          className: \"mt-1 mb-1\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 186\n          },\n          __self: this\n        }, \"\".concat(this.getText('Total restante: $'), \" \").concat(appointment.totalPrice - paid));\n      }\n\n      return null;\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this3 = this;\n\n      var date = this.props.date;\n      var appointment = this.state.appointment;\n      return React.createElement(React.Fragment, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 195\n        },\n        __self: this\n      }, React.createElement(Modal, {\n        width: \"70%\",\n        height: \"95%\",\n        show: true,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 196\n        },\n        __self: this\n      }, React.createElement(ModalHeader, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 197\n        },\n        __self: this\n      }, React.createElement(Level, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 198\n        },\n        __self: this\n      }, React.createElement(LevelLeft, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 199\n        },\n        __self: this\n      }, React.createElement(Title, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 200\n        },\n        __self: this\n      }, \"\".concat(moment(date).format('LL')))), React.createElement(LevelRight, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 202\n        },\n        __self: this\n      }, React.createElement(Button, {\n        icon: \"plus\",\n        name: \"cancelled\",\n        kind: \"link\",\n        size: \"xl\",\n        onClick: function onClick() {\n          return _this3.handlePay('cancelled');\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 203\n        },\n        __self: this\n      }, React.createElement(FontAwesomeIcon, {\n        icon: faTimes,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 204\n        },\n        __self: this\n      }))))), React.createElement(ModalContent, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 209\n        },\n        __self: this\n      }, React.createElement(Columns, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 210\n        },\n        __self: this\n      }, React.createElement(Column, {\n        isSize: 5,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 211\n        },\n        __self: this\n      }, React.createElement(Title, {\n        size: \"md\",\n        className: \"mb-1\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 212\n        },\n        __self: this\n      }, \"\".concat(this.getText('Total a abonar: $'), \" \").concat(appointment.totalPrice)), this.renderPartial(), this.renderPending(), React.createElement(Title, {\n        className: \"mt-1\",\n        size: \"md\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 215\n        },\n        __self: this\n      }, \"\".concat(appointment.clientPoints, \"  \").concat(this.getText('puntos disponibles '), \" \", ' ($ ', \" \").concat(this.props.store.ui.getChange('changePurchase').convertPoints(appointment.clientPoints), ')')), React.createElement(PaymentForm, {\n        totalAmount: appointment.totalPrice,\n        clientPoints: appointment.clientPoints,\n        onChange: this.handlePaymentData,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 216\n        },\n        __self: this\n      }), !this.isValidPayment() && React.createElement(Panel, {\n        className: \"mt-1\",\n        color: \"error\",\n        invert: true,\n        style: {\n          padding: '2px'\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 218\n        },\n        __self: this\n      }, React.createElement(Text, {\n        className: \"has-text-centered\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 223\n        },\n        __self: this\n      }, this.state.invalidMsg))), React.createElement(Column, {\n        className: \"has-text-centered\",\n        isSize: 7,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 226\n        },\n        __self: this\n      }, React.createElement(SvgDraw, {\n        style: {\n          height: '450px',\n          width: '450px'\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 227\n        },\n        __self: this\n      })))), React.createElement(ModalFooter, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 231\n        },\n        __self: this\n      }, React.createElement(Level, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 232\n        },\n        __self: this\n      }, React.createElement(LevelLeft, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 233\n        },\n        __self: this\n      }, React.createElement(Button, {\n        kind: \"outline\",\n        name: \"paid\",\n        onClick: this.handleConfirm,\n        disabled: this.getDisabled(),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 234\n        },\n        __self: this\n      }, this.getText('Efectuar pago')))))), this.state.confirmation && this.renderConfirmationModal());\n    }\n  }]);\n\n  return PaymentsModal;\n}(Component)) || _class;\n\nPaymentsModal.PropTypes = {\n  date: PropTypes.object,\n  onPay: PropTypes.func,\n  appointment: PropTypes.object\n};\nPaymentsModal.defaultProps = {\n  date: null,\n  onPay: null,\n  appointment: null\n};\nexport default withToastManager(withStore(PaymentsModal));","map":{"version":3,"sources":["/Users/wpereyra/Documents/Universidad/PP1/look_app_fe/src/components/Payments/PaymentModal.jsx"],"names":["React","Component","PropTypes","moment","withToastManager","Modal","ModalHeader","ModalContent","ModalFooter","Title","Button","Text","Panel","Level","LevelLeft","LevelRight","Columns","Column","faTimes","PaymentForm","FontAwesomeIcon","withStore","ConfirmationModal","observer","translate","PaymentsModal","props","state","confirmation","appointment","paymentType","cash","points","validCash","validPoints","validCashAndPoints","invalidMsg","confirmationData","accept","cancel","title","content","handleConfirm","bind","handleCancelConfirm","handlePay","handlePaymentData","name","onPay","loan","then","response","pay","sender","value","valid","message","type","setState","data","getText","text","store","ui","language","payments","length","paid","forEach","payment","parseFloat","amount","totalPrice","date","format","renderPartial","renderPending","clientPoints","getChange","convertPoints","isValidPayment","padding","height","width","getDisabled","renderConfirmationModal","object","func","defaultProps"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\n\nimport moment from 'moment';\n\nimport { withToastManager } from 'react-toast-notifications';\n\nimport {\n  Modal,\n  ModalHeader,\n  ModalContent,\n  ModalFooter,\n  Title,\n  Button,\n  Text,\n  Panel\n} from 'shipnow-mercurio';\n\nimport {\n  Level,\n  LevelLeft,\n  LevelRight,\n  Columns,\n  Column\n} from 'bloomer';\n\nimport { \n  faTimes, \n} from \"@fortawesome/free-solid-svg-icons\";\n\nimport { PaymentForm } from './';\n\nimport FontAwesomeIcon from \"@fortawesome/react-fontawesome\";\n\nimport { withStore } from '../../hocs';\n\nimport { ConfirmationModal } from '../ConfirmationModal';\n\nimport { observer } from 'mobx-react';\n\nimport { translate } from '../../lib/Translator';\n\nimport { ReactComponent as SvgDraw } from '../../assets/undraw_Savings_dwkw.svg';\n\n@observer\nclass PaymentsModal extends Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      confirmation: false,\n      appointment: this.props.appointment,\n      paymentType: '',\n      cash: null,\n      points: null,\n      validCash: false,\n      validPoints: false,\n      validCashAndPoints: false,\n      invalidMsg: '',\n      confirmationData: {\n        accept: null,\n        cancel: null,\n        title: null,\n        content: null,\n      }\n    }\n\n    this.handleConfirm       = this.handleConfirm.bind(this);\n    this.handleCancelConfirm = this.handleCancelConfirm.bind(this);\n    this.handlePay           = this.handlePay.bind(this);\n    this.handlePaymentData   = this.handlePaymentData.bind(this);\n  }\n\n  handlePay( name ) {\n    if( name=='cancelled' ){\n      this.props.onPay && this.props.onPay('cancelled')\n    }else if(this.state.paymentType == 'loaned'){\n      this.state.appointment.loan().then( response =>{ this.props.onPay && this.props.onPay('paid', response) });\n    }else{\n      this.state.appointment.pay(this.state.cash,this.state.points).then( response =>{ this.props.onPay && this.props.onPay('paid', response) });\n    }\n  }\n\n  handlePaymentData(sender, value, name, valid, message) {\n    if(name == 'cash'){\n      valid && valid.type == 'success' ? this.setState({cash: value, points: null, paymentType: 'cash', validCash: true}) : this.setState({ paymentType: 'cash', validCash: false, invalidMsg: message})\n    }\n    if(name == 'points'){\n      valid && valid.type == 'success' ? this.setState({points: value, cash: null, paymentType: 'points', validPoints: true}) : this.setState({ paymentType: 'points', validPoints: false, invalidMsg: message})\n    }\n    if(name == 'cashHalf'){\n      valid ? this.setState({cash: value, paymentType: 'cashAndPoints', validCashAndPoints: valid}) : this.setState({ paymentType: 'cashAndPoints', validCashAndPoints: false, invalidMsg: message})\n    }\n    if(name == 'pointsHalf'){\n      valid ? this.setState({points: value, paymentType: 'cashAndPoints', validCashAndPoints: valid}) : this.setState({ paymentType: 'cashAndPoints', validCashAndPoints: false, invalidMsg: message})\n    }\n    if(name == 'loaned'){\n      this.setState({points: null, cash: null, paymentType: 'loaned'})\n    }\n  }\n\n  handleCancelConfirm() {\n    this.setState({\n      confirmation: false,\n    })\n  }\n\n  handleConfirm( ) {\n    let data = {};\n\n    data['title']   = this.getText('Abonar turno');\n    data['accept']  = this.handlePay;\n    data['cancel']  = this.handleCancelConfirm;\n    data['content'] = this.getText('Estás por efectuar el pago. ¿Estás seguro?');\n\n    this.setState({\n      confirmation:true,\n      confirmationData: data,\n    });\n  }\n\n  renderConfirmationModal() {\n    const { confirmationData } = this.state;\n    return (<ConfirmationModal \n              title=   { confirmationData.title   }\n              content= { confirmationData.content } \n              onAccept={ confirmationData.accept  } \n              onCancel={ confirmationData.cancel  } />)\n  }\n\n  getDisabled() {\n    if(this.state.paymentType == 'cash'){\n      return !this.state.validCash\n    }\n    if(this.state.paymentType == 'points'){\n      return !this.state.validPoints\n    }\n    if(this.state.paymentType == 'cashAndPoints'){\n      return !this.state.validCashAndPoints\n    }\n    if(this.state.paymentType == 'loaned'){\n      return false\n    }else{\n      return true\n    }\n  }\n\n  isValidPayment() {\n    if(this.state.paymentType == 'cashAndPoints'){\n      return this.state.validCashAndPoints\n    }\n    if(this.state.paymentType == 'cash'){\n      return this.state.validCash\n    }\n    if(this.state.paymentType == 'points'){\n      return this.state.validPoints\n    }\n    else{\n      return true\n    }\n  }\n\n  getText( text ) {\n    return translate(text, this.props.store.ui.language)\n  }\n\n  renderPartial() {\n    const { appointment } = this.state;\n    if (appointment.payments.length > 0) {\n      let paid = 0;\n      appointment.payments.forEach(payment => {\n        paid += parseFloat(payment.amount);\n      });\n      return <Title size=\"md\" className=\"mt-1 mb-1\">{ `${ this.getText('Total abonado: $') } ${paid}` }</Title>\n    }\n    return null;\n  }\n\n  renderPending() {\n    const { appointment } = this.state;\n    if (appointment.payments.length > 0) {\n      let paid = 0;\n      appointment.payments.forEach(payment => {\n        paid += parseFloat(payment.amount);\n      });\n      return <Title size=\"md\" className=\"mt-1 mb-1\">{ `${ this.getText('Total restante: $') } ${appointment.totalPrice - paid}` }</Title>\n    }\n    return null;\n  }\n\n  render() {\n    const { date } = this.props\n    const { appointment } = this.state\n    return(\n      <React.Fragment>\n        <Modal width=\"70%\" height=\"95%\" show>\n          <ModalHeader>\n            <Level>\n              <LevelLeft>\n                <Title>{ `${ moment(date).format('LL') }` }</Title>\n              </LevelLeft>\n              <LevelRight>\n              <Button icon=\"plus\" name=\"cancelled\" kind=\"link\" size=\"xl\" onClick={() => this.handlePay('cancelled') }>\n                <FontAwesomeIcon icon={ faTimes }/>\n              </Button>\n              </LevelRight>\n              </Level>\n          </ModalHeader>\n          <ModalContent>\n              <Columns>\n                <Column isSize={ 5 }>\n                  <Title size=\"md\" className=\"mb-1\">{ `${ this.getText('Total a abonar: $') } ${appointment.totalPrice}` }</Title>\n                  { this.renderPartial() }\n                  { this.renderPending() }\n                  <Title className=\"mt-1\" size=\"md\">{ `${appointment.clientPoints}  ${ this.getText('puntos disponibles ') } ${ ' ($ '} ${ this.props.store.ui.getChange('changePurchase').convertPoints(appointment.clientPoints) }${ ')'}`}</Title>\n                  <PaymentForm totalAmount={ appointment.totalPrice } clientPoints={ appointment.clientPoints } onChange={ this.handlePaymentData }></PaymentForm>\n                  { !this.isValidPayment() && \n                  <Panel \n                    className=\"mt-1\" \n                    color=\"error\" \n                    invert \n                    style={{padding: '2px'}}>\n                    <Text className=\"has-text-centered\">{ this.state.invalidMsg }</Text>\n                  </Panel> }\n                </Column>\n                <Column className=\"has-text-centered\" isSize={ 7 }>\n                  <SvgDraw style={{ height: '450px', width: '450px' }}/>\n                </Column>\n              </Columns>\n            </ModalContent>\n          <ModalFooter>\n            <Level>\n              <LevelLeft>\n                  <Button kind=\"outline\" name=\"paid\" onClick={ this.handleConfirm } disabled={ this.getDisabled() }>{this.getText('Efectuar pago')}</Button>\n              </LevelLeft>\n            </Level>\n          </ModalFooter>\n        </Modal>\n        { this.state.confirmation && this.renderConfirmationModal() }\n      </React.Fragment>)\n  }\n}\nPaymentsModal.PropTypes = {\n  date: PropTypes.object,\n  onPay: PropTypes.func,\n  appointment: PropTypes.object\n}\n\nPaymentsModal.defaultProps = {\n  date: null,\n  onPay: null,\n  appointment: null\n}\n\nexport default withToastManager(withStore(PaymentsModal));"]},"metadata":{},"sourceType":"module"}