{"ast":null,"code":"import _defineProperty from \"/Users/wpereyra/Documents/Universidad/PP1/look_app_fe/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _classCallCheck from \"/Users/wpereyra/Documents/Universidad/PP1/look_app_fe/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/wpereyra/Documents/Universidad/PP1/look_app_fe/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/wpereyra/Documents/Universidad/PP1/look_app_fe/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/wpereyra/Documents/Universidad/PP1/look_app_fe/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/wpereyra/Documents/Universidad/PP1/look_app_fe/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _assertThisInitialized from \"/Users/wpereyra/Documents/Universidad/PP1/look_app_fe/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\n\nvar _class,\n    _jsxFileName = \"/Users/wpereyra/Documents/Universidad/PP1/look_app_fe/src/views/Reports/ProfessionalsReport/ProfessionalsReportView.jsx\";\n\nimport React, { Component } from 'react';\nimport { withRouter } from 'react-router';\nimport { Bar } from 'react-chartjs-2';\nimport withStore from '../../../hocs/withStore';\nimport { observer } from 'mobx-react';\nimport { translate } from '../../../lib/Translator';\nimport { Column, Columns, Level, LevelLeft } from 'bloomer';\nimport { Title, Select, Field, DateTimePicker } from 'shipnow-mercurio';\nimport { faChevronDown } from '@fortawesome/free-solid-svg-icons';\nimport moment from 'moment';\n\nvar ProfessionalsReportView = observer(_class =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(ProfessionalsReportView, _Component);\n\n  function ProfessionalsReportView(props) {\n    var _this;\n\n    _classCallCheck(this, ProfessionalsReportView);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(ProfessionalsReportView).call(this, props));\n    _this.state = {\n      sort: 'asc',\n      data: null,\n      branches: null,\n      fromDate: moment().startOf('month'),\n      toDate: moment(),\n      branch: null\n    };\n    _this.handleChange = _this.handleChange.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    _this.handleSort = _this.handleSort.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    return _this;\n  }\n\n  _createClass(ProfessionalsReportView, [{\n    key: \"handleSort\",\n    value: function handleSort(sort) {\n      this.setState({\n        sort: sort\n      });\n    }\n  }, {\n    key: \"handleChange\",\n    value: function handleChange(sender, value, name, valid) {\n      if (name == 'branch' && value == 'null') {\n        this.setState({\n          branch: null\n        });\n      } else {\n        this.setState(_defineProperty({}, name, value));\n      }\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate(prevProps, prevState) {\n      if (prevState.branch != this.state.branch) {\n        this.sendRequest();\n      }\n\n      if (prevState.toDate != this.state.toDate) {\n        this.sendRequest();\n      }\n\n      if (prevState.fromDate != this.state.fromDate) {\n        this.sendRequest();\n      }\n    }\n  }, {\n    key: \"sendRequest\",\n    value: function sendRequest() {\n      var reqParams = {};\n\n      if (this.state.branch) {\n        reqParams['branchId'] = this.state.branch;\n      }\n\n      if (this.state.toDate) {\n        reqParams['toDate'] = this.state.toDate;\n      }\n\n      if (this.state.fromDate) {\n        reqParams['fromDate'] = this.state.fromDate;\n      }\n\n      this.setState({\n        data: this.props.store.reports.getProfessionalsReport(reqParams)\n      });\n    }\n  }, {\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.sendRequest();\n      this.setState({\n        branches: this.props.store.branches.search({}, 'branches-list', true)\n      });\n    }\n  }, {\n    key: \"getText\",\n    value: function getText(text) {\n      return translate(text, this.props.store.ui.language);\n    }\n  }, {\n    key: \"sort\",\n    value: function sort(data) {\n      if (this.state.sort == 'asc') {\n        return data.sort(function (a, b) {\n          return b.totalAmount - a.totalAmount;\n        });\n      } else {\n        return data.sort(function (a, b) {\n          return a.totalAmount - b.totalAmount;\n        });\n      }\n    }\n  }, {\n    key: \"getChartData\",\n    value: function getChartData() {\n      var sortedData = this.sort(this.state.data.toArray());\n      return {\n        labels: sortedData.map(function (item) {\n          return item.professional.fullName;\n        }),\n        datasets: [{\n          label: 'Ingresos',\n          backgroundColor: 'rgba(255,99,132,0.2)',\n          borderColor: 'rgba(255,99,132,1)',\n          borderWidth: 1,\n          hoverBackgroundColor: 'rgba(255,99,132,0.4)',\n          hoverBorderColor: 'rgba(255,99,132,1)',\n          data: sortedData.map(function (item) {\n            return parseFloat(item.totalAmount);\n          })\n        }]\n      };\n    }\n  }, {\n    key: \"getChartConfig\",\n    value: function getChartConfig() {\n      return {\n        maintainAspectRatio: false,\n        title: {\n          display: true,\n          text: this.getText('Ingresos por profesionales'),\n          fontSize: '18'\n        },\n        legend: {\n          display: false\n        },\n        tooltips: {\n          callbacks: {\n            label: function label(tooltipItem) {\n              return \"Total facturado: $\".concat(tooltipItem.yLabel);\n            },\n            title: function title(tooltipItem) {\n              return \"Ingresos generados por \".concat(tooltipItem[0].xLabel);\n            }\n          }\n        },\n        scales: {\n          xAxes: [{\n            stacked: true\n          }],\n          yAxes: [{\n            stacked: true\n          }]\n        }\n      };\n    }\n  }, {\n    key: \"getBranchesList\",\n    value: function getBranchesList() {\n      var ret = [];\n      ret.push({\n        key: this.getText('- Ninguna -'),\n        value: 'null'\n      });\n      this.state.branches.toArray().forEach(function (branch) {\n        ret.push({\n          key: branch.name || branch.cookedAddress,\n          value: branch.id\n        });\n      });\n      return ret;\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      var isReportDataLoaded = this.state.data && this.state.data.isOk();\n      var isBranchesLoaded = this.state.branches && this.state.branches.isOk();\n\n      if (isReportDataLoaded && isBranchesLoaded) {\n        return React.createElement(React.Fragment, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 191\n          },\n          __self: this\n        }, React.createElement(Level, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 192\n          },\n          __self: this\n        }, React.createElement(LevelLeft, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 193\n          },\n          __self: this\n        }, React.createElement(Title, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 194\n          },\n          __self: this\n        }, this.getText('Reporte de profesionales')))), React.createElement(\"hr\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 197\n          },\n          __self: this\n        }), React.createElement(Columns, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 198\n          },\n          __self: this\n        }, React.createElement(Column, {\n          isSize: 3,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 199\n          },\n          __self: this\n        }, React.createElement(Field, {\n          label: this.getText('¿Querés filtrar y ver ingresos por sucursal?'),\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 200\n          },\n          __self: this\n        }, React.createElement(Select, {\n          className: \"is-fullwidth\",\n          placeholder: \"Sucursales\",\n          name: \"branch\",\n          borderless: true,\n          value: this.state.branch,\n          icon: faChevronDown,\n          options: this.getBranchesList(),\n          onChange: this.handleChange,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 201\n          },\n          __self: this\n        }))), React.createElement(Column, {\n          isSize: 3,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 212\n          },\n          __self: this\n        }, React.createElement(Field, {\n          label: this.getText('Desde'),\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 213\n          },\n          __self: this\n        }, React.createElement(DateTimePicker, {\n          name: \"fromDate\",\n          onChange: this.handleChange,\n          value: this.state.fromDate,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 214\n          },\n          __self: this\n        }))), React.createElement(Column, {\n          isSize: 3,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 220\n          },\n          __self: this\n        }, React.createElement(Field, {\n          label: this.getText('Hasta'),\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 221\n          },\n          __self: this\n        }, React.createElement(DateTimePicker, {\n          name: \"toDate\",\n          onChange: this.handleChange,\n          value: this.state.toDate,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 222\n          },\n          __self: this\n        }))), React.createElement(Column, {\n          isSize: 3,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 228\n          },\n          __self: this\n        }, React.createElement(Field, {\n          label: this.getText('Ordernamiento'),\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 229\n          },\n          __self: this\n        }, React.createElement(\"div\", {\n          style: {\n            display: 'flex',\n            flexDirection: 'column'\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 230\n          },\n          __self: this\n        }, React.createElement(\"div\", {\n          style: {\n            display: 'flex',\n            flexDirection: 'row',\n            alignItems: 'center'\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 231\n          },\n          __self: this\n        }, React.createElement(\"input\", {\n          className: \"ml-1 mr-1\",\n          type: \"radio\",\n          value: \"asc\",\n          onChange: function onChange() {\n            return _this2.handleSort('asc');\n          },\n          checked: this.state.sort == 'asc',\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 232\n          },\n          __self: this\n        }), this.getText('Ascendiente')), React.createElement(\"div\", {\n          style: {\n            display: 'flex',\n            flexDirection: 'row',\n            alignItems: 'center',\n            marginTop: '8px'\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 240\n          },\n          __self: this\n        }, React.createElement(\"input\", {\n          className: \"ml-1 mr-1\",\n          type: \"radio\",\n          value: \"desc\",\n          onChange: function onChange() {\n            return _this2.handleSort('desc');\n          },\n          checked: this.state.sort == 'desc',\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 241\n          },\n          __self: this\n        }), this.getText('Descendiente')))))), React.createElement(Columns, {\n          className: \"pt-5\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 253\n          },\n          __self: this\n        }, React.createElement(Bar, {\n          key: this.state.data,\n          data: this.getChartData(),\n          width: 100,\n          height: 450,\n          options: this.getChartConfig(),\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 254\n          },\n          __self: this\n        })));\n      }\n\n      return null;\n    }\n  }]);\n\n  return ProfessionalsReportView;\n}(Component)) || _class;\n\nexport default withStore(withRouter(ProfessionalsReportView));","map":{"version":3,"sources":["/Users/wpereyra/Documents/Universidad/PP1/look_app_fe/src/views/Reports/ProfessionalsReport/ProfessionalsReportView.jsx"],"names":["React","Component","withRouter","Bar","withStore","observer","translate","Column","Columns","Level","LevelLeft","Title","Select","Field","DateTimePicker","faChevronDown","moment","ProfessionalsReportView","props","state","sort","data","branches","fromDate","startOf","toDate","branch","handleChange","bind","handleSort","setState","sender","value","name","valid","prevProps","prevState","sendRequest","reqParams","store","reports","getProfessionalsReport","search","text","ui","language","a","b","totalAmount","sortedData","toArray","labels","map","item","professional","fullName","datasets","label","backgroundColor","borderColor","borderWidth","hoverBackgroundColor","hoverBorderColor","parseFloat","maintainAspectRatio","title","display","getText","fontSize","legend","tooltips","callbacks","tooltipItem","yLabel","xLabel","scales","xAxes","stacked","yAxes","ret","push","key","forEach","cookedAddress","id","isReportDataLoaded","isOk","isBranchesLoaded","getBranchesList","flexDirection","alignItems","marginTop","getChartData","getChartConfig"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport { withRouter } from 'react-router';\n\nimport {Bar} from 'react-chartjs-2';\n\nimport withStore from '../../../hocs/withStore';\n\nimport { observer } from 'mobx-react';\n\nimport { translate } from '../../../lib/Translator'; \n\nimport {\n  Column,\n  Columns,\n  Level,\n  LevelLeft\n} from 'bloomer';\n\nimport {\n  Title,\n  Select,\n  Field,\n  DateTimePicker,\n} from 'shipnow-mercurio';\n\nimport { faChevronDown } from '@fortawesome/free-solid-svg-icons';\n\nimport moment from 'moment';\n\n@observer\nclass ProfessionalsReportView extends Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      sort: 'asc',\n      data: null,\n      branches: null,\n      fromDate: moment().startOf('month'),\n      toDate: moment(),\n      branch: null,\n    }\n\n    this.handleChange = this.handleChange.bind(this);\n    this.handleSort   = this.handleSort.bind(this);\n  }\n\n  handleSort(sort) {\n    this.setState({\n      sort,\n    })\n  }\n\n  handleChange(sender, value, name, valid) {\n    if (name == 'branch' && value == 'null') {\n      this.setState({\n        branch: null,\n      })\n    }\n    else {\n      this.setState({\n        [name]: value,\n      });\n    }\n  }\n\n  componentDidUpdate(prevProps, prevState) {\n    if (prevState.branch != this.state.branch) {\n      this.sendRequest();\n    }  \n    if (prevState.toDate != this.state.toDate) {\n      this.sendRequest();\n    }  \n    if (prevState.fromDate != this.state.fromDate) {\n      this.sendRequest();\n    }  \n  }\n\n  sendRequest() {\n    const reqParams = {};\n    if (this.state.branch) {\n      reqParams['branchId'] = this.state.branch;\n    }\n    if (this.state.toDate) {\n      reqParams['toDate'] = this.state.toDate;\n    }\n    if (this.state.fromDate) {\n      reqParams['fromDate'] = this.state.fromDate;\n    }\n\n    this.setState({\n      data: this.props.store.reports.getProfessionalsReport(reqParams)\n    })\n  }\n\n  componentDidMount() {\n    this.sendRequest();\n    this.setState({\n      branches: this.props.store.branches.search({}, 'branches-list', true),\n    })\n  }\n  \n\n  getText( text ) {\n    return translate(text, this.props.store.ui.language)\n  }\n\n  sort(data) {\n    if (this.state.sort == 'asc') {\n      return data.sort((a, b) => b.totalAmount - a.totalAmount);\n    }\n    else {\n      return data.sort((a, b) => a.totalAmount - b.totalAmount);\n    }\n  }\n\n  getChartData() {\n    const sortedData = this.sort(this.state.data.toArray());\n    return {\n      labels: sortedData.map(item => (item.professional.fullName)),\n      datasets: [\n        {\n          label: 'Ingresos',\n          backgroundColor: 'rgba(255,99,132,0.2)',\n          borderColor: 'rgba(255,99,132,1)',\n          borderWidth: 1,\n          hoverBackgroundColor: 'rgba(255,99,132,0.4)',\n          hoverBorderColor: 'rgba(255,99,132,1)',\n          data: sortedData.map(item => (parseFloat(item.totalAmount))),\n        }\n      ]\n    };\n  }\n\n  getChartConfig() {\n    return {\n      maintainAspectRatio: false,\n      title: {\n        display: true,\n        text: this.getText('Ingresos por profesionales'),\n        fontSize: '18',\n      },\n      legend: {\n        display: false,\n      },\n      tooltips: {\n        callbacks: {\n          label: function(tooltipItem) {\n            return `Total facturado: $${tooltipItem.yLabel}`\n          },\n          title: function(tooltipItem) {\n            return `Ingresos generados por ${tooltipItem[0].xLabel}`\n          } \n        }\n      },\n      scales: {\n        xAxes: [\n          {\n            stacked: true\n          }\n        ],\n        yAxes: [\n          {\n            stacked: true\n          }\n        ]\n      }\n    }\n  }\n\n  getBranchesList() {\n    const ret = [];\n    ret.push({\n      key: this.getText('- Ninguna -'),\n      value: 'null',\n    })\n    this.state.branches.toArray().forEach(branch => {\n      ret.push({\n          key: branch.name || branch.cookedAddress, \n          value: branch.id\n        });\n      });\n    return ret;\n  }\n\n  render() {\n    const isReportDataLoaded = this.state.data && this.state.data.isOk();\n    const isBranchesLoaded = this.state.branches && this.state.branches.isOk();\n    if (isReportDataLoaded && isBranchesLoaded) {\n      return(\n        <React.Fragment>\n          <Level>\n            <LevelLeft>\n              <Title>{ this.getText('Reporte de profesionales') }</Title>\n            </LevelLeft>\n          </Level>\n          <hr/>\n            <Columns>\n              <Column isSize={ 3 }>\n                <Field label={ this.getText('¿Querés filtrar y ver ingresos por sucursal?') }>\n                <Select \n                  className=\"is-fullwidth\" \n                  placeholder=\"Sucursales\" \n                  name=\"branch\" \n                  borderless\n                  value={ this.state.branch }\n                  icon={ faChevronDown } \n                  options={ this.getBranchesList() } \n                  onChange={this.handleChange} />\n                </Field>\n              </Column>\n              <Column isSize={ 3 }>\n                <Field label={ this.getText('Desde') }>\n                  <DateTimePicker \n                    name=\"fromDate\" \n                    onChange={ this.handleChange } \n                    value={ this.state.fromDate }/>\n                </Field>\n              </Column>\n              <Column isSize={ 3 }>\n                <Field label={ this.getText('Hasta') }>\n                  <DateTimePicker \n                    name=\"toDate\"\n                    onChange={ this.handleChange } \n                    value={ this.state.toDate } />\n                </Field>\n              </Column>\n              <Column isSize={ 3 }>\n                <Field label={ this.getText('Ordernamiento') }>\n                  <div style={{display: 'flex', flexDirection:'column'}}>\n                    <div style={{display: 'flex', flexDirection:'row', alignItems: 'center'}}>\n                      <input \n                        className=\"ml-1 mr-1\" \n                        type=\"radio\" \n                        value=\"asc\" \n                        onChange={ () => (this.handleSort('asc')) }\n                        checked={ this.state.sort == 'asc'} />\n                        { this.getText('Ascendiente') }\n                    </div>\n                    <div style={{display: 'flex', flexDirection:'row', alignItems: 'center', marginTop: '8px'}}>\n                      <input \n                        className=\"ml-1 mr-1\" \n                        type=\"radio\" \n                        value=\"desc\" \n                        onChange={ () => (this.handleSort('desc')) }\n                        checked={ this.state.sort == 'desc'} />\n                        { this.getText('Descendiente') }\n                    </div>\n                  </div>\n                </Field>\n              </Column>\n            </Columns>\n          <Columns className=\"pt-5\">\n          <Bar\n            key={ this.state.data }\n            data={this.getChartData()}\n            width={100}\n            height={450}\n            options={this.getChartConfig()}\n        />\n          </Columns>\n        </React.Fragment> );\n    }\n    return null\n  }\n}\n\nexport default withStore(withRouter(ProfessionalsReportView));"]},"metadata":{},"sourceType":"module"}