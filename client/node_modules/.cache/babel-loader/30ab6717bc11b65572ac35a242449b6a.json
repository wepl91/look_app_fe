{"ast":null,"code":"import _initializerDefineProperty from \"/Users/wpereyra/Documents/Universidad/PP1/look_app_fe/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/initializerDefineProperty\";\nimport _classCallCheck from \"/Users/wpereyra/Documents/Universidad/PP1/look_app_fe/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/wpereyra/Documents/Universidad/PP1/look_app_fe/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _applyDecoratedDescriptor from \"/Users/wpereyra/Documents/Universidad/PP1/look_app_fe/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/applyDecoratedDescriptor\";\nimport _initializerWarningHelper from \"/Users/wpereyra/Documents/Universidad/PP1/look_app_fe/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/initializerWarningHelper\";\n\nvar _class, _descriptor, _descriptor2, _descriptor3;\n\nimport { observable, action, computed, toJS as _toJS } from 'mobx';\nimport moment from 'moment';\nvar Model = (_class =\n/*#__PURE__*/\nfunction () {\n  // empty | first-load | busy | ok | error\n  function Model(attributes, store) {\n    _classCallCheck(this, Model);\n\n    _initializerDefineProperty(this, \"attributes\", _descriptor, this);\n\n    this._uriBase = '';\n    this._primaryKey = 'id';\n    this._store = null;\n    this._error = null;\n    this.abilities = {};\n\n    _initializerDefineProperty(this, \"_lastUpdateAt\", _descriptor2, this);\n\n    _initializerDefineProperty(this, \"_status\", _descriptor3, this);\n\n    this._store = store;\n    this._status = 'empty';\n    this.set(attributes);\n  }\n  /**\n   * Model shallow serialization \n   *\n   */\n\n\n  _createClass(Model, [{\n    key: \"toJS\",\n    value: function toJS() {\n      return _toJS(this.attributes);\n    }\n    /**\n     * Returns a dettached copy from the store collection\n     *\n     */\n\n  }, {\n    key: \"clone\",\n    value: function clone() {\n      //let ModelClass = this._store.model;\n      var clone = new ModelClass(this.toJS(), this._store);\n      clone._status = this._status;\n      return clone;\n    }\n    /**\n     * Model serialization for REST operations \n     *\n     */\n\n  }, {\n    key: \"toParams\",\n    value: function toParams() {\n      return this.toJS();\n    }\n  }, {\n    key: \"isEmpty\",\n    value: function isEmpty() {\n      return this._status == 'empty' || this._status == 'first-load';\n    }\n  }, {\n    key: \"isBusy\",\n    value: function isBusy() {\n      return this._status == 'busy' || this._status == 'first-load';\n    }\n  }, {\n    key: \"isOk\",\n    value: function isOk() {\n      return this._status == 'ok';\n    }\n  }, {\n    key: \"isError\",\n    value: function isError() {\n      return this._status == 'error';\n    }\n  }, {\n    key: \"canBe\",\n    value: function canBe(action) {\n      var loggedInUser = null;\n\n      if (this._store.appStore) {\n        loggedInUser = this._store.appStore.loggedInUser;\n      }\n\n      if (this.abilities.hasOwnProperty(action)) {\n        return this.abilities[action](loggedInUser);\n      }\n\n      return true;\n    }\n  }, {\n    key: \"has\",\n    value: function has(attribute) {\n      return this.attributes.has(attribute);\n    }\n  }, {\n    key: \"get\",\n    value: function get(attribute) {\n      if (this.attributes.has(attribute)) {\n        return this.attributes.get(attribute);\n      }\n\n      return null;\n    }\n  }, {\n    key: \"beginUpdate\",\n    value: function beginUpdate() {\n      this._status = this._status === 'empty' ? 'first-load' : 'busy';\n    }\n  }, {\n    key: \"endUpdate\",\n    value: function endUpdate(error) {\n      if (error) {\n        try {\n          this._error = error.message ? JSON.parse(error.message)['errors'] : error;\n          this._status = 'error';\n        } catch (err) {\n          this._error = error;\n          this._status = 'error';\n        }\n\n        this._status = 'error';\n        this.modelDidUpdate();\n      } else {\n        this._status = 'ok';\n        this.modelDidUpdate();\n      }\n\n      if (this._onUpdateCallback) {\n        this._onUpdateCallback(this, error);\n\n        this._onUpdateCallback = null;\n      }\n\n      this._lastUpdateAt = moment();\n    }\n  }, {\n    key: \"needsUpdate\",\n    value: function needsUpdate() {\n      if (this._status == 'busy') return false;\n      return this._status == 'empty' || moment().diff(this._lastUpdateAt, 'minutes') > this._store.updateThreshold; // this should be parametrized\n    }\n  }, {\n    key: \"transformData\",\n    value: function transformData(data) {\n      if (data !== undefined && data.attributes !== undefined) {\n        return data.attributes;\n      }\n\n      return data;\n    }\n  }, {\n    key: \"afterSetData\",\n    value: function afterSetData() {}\n  }, {\n    key: \"set\",\n    value: function set(data) {\n      var _this = this;\n\n      this.attributes.merge(this.transformData(data));\n      this.attributes.forEach(function (value, key) {\n        if (_this[key] === undefined) Object.defineProperty(_this, key, {\n          set: function set(v) {\n            return _this.attributes.set(key, v);\n          },\n          get: function get(v) {\n            return _this.get(key);\n          }\n        });\n      });\n      this.afterSetData();\n      this._lastUpdateAt = moment();\n    }\n  }, {\n    key: \"setField\",\n    value: function setField(field, data) {\n      var _this2 = this;\n\n      this.attributes.set(field, data);\n      this._lastUpdateAt = moment();\n      Object.defineProperty(this, field, {\n        set: function set(v) {\n          return _this2.attributes.set(field, v);\n        },\n        get: function get(v) {\n          return _this2.get(field);\n        }\n      });\n    }\n  }, {\n    key: \"modelDidUpdate\",\n    value: function modelDidUpdate() {}\n  }, {\n    key: \"andThen\",\n    value: function andThen(_callback) {\n      if (this.isOk()) {\n        _callback && _callback(this);\n        return this;\n      }\n\n      this._onUpdateCallback = _callback;\n      return this;\n    }\n  }, {\n    key: \"save\",\n    value: function save() {\n      return this._store.save(this);\n    }\n  }, {\n    key: \"delete\",\n    value: function _delete() {\n      return this._store.destroy(this);\n    }\n  }, {\n    key: \"modelURI\",\n    get: function get() {\n      if (this.isNew) {\n        return this._uriBase;\n      } else {\n        return \"\".concat(this._uriBase, \"/\").concat(this.get(this._primaryKey));\n      }\n    }\n  }, {\n    key: \"isNew\",\n    get: function get() {\n      return !this.has(this._primaryKey);\n    }\n  }, {\n    key: \"id\",\n    get: function get() {\n      return this.has(this._primaryKey) ? this.get(this._primaryKey) : null;\n    }\n  }, {\n    key: \"appStore\",\n    get: function get() {\n      return this._store.appStore;\n    }\n  }]);\n\n  return Model;\n}(), (_descriptor = _applyDecoratedDescriptor(_class.prototype, \"attributes\", [observable], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: function initializer() {\n    return new Map();\n  }\n}), _descriptor2 = _applyDecoratedDescriptor(_class.prototype, \"_lastUpdateAt\", [observable], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n}), _descriptor3 = _applyDecoratedDescriptor(_class.prototype, \"_status\", [observable], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n}), _applyDecoratedDescriptor(_class.prototype, \"modelURI\", [computed], Object.getOwnPropertyDescriptor(_class.prototype, \"modelURI\"), _class.prototype), _applyDecoratedDescriptor(_class.prototype, \"isNew\", [computed], Object.getOwnPropertyDescriptor(_class.prototype, \"isNew\"), _class.prototype), _applyDecoratedDescriptor(_class.prototype, \"beginUpdate\", [action], Object.getOwnPropertyDescriptor(_class.prototype, \"beginUpdate\"), _class.prototype), _applyDecoratedDescriptor(_class.prototype, \"endUpdate\", [action], Object.getOwnPropertyDescriptor(_class.prototype, \"endUpdate\"), _class.prototype), _applyDecoratedDescriptor(_class.prototype, \"afterSetData\", [action], Object.getOwnPropertyDescriptor(_class.prototype, \"afterSetData\"), _class.prototype), _applyDecoratedDescriptor(_class.prototype, \"set\", [action], Object.getOwnPropertyDescriptor(_class.prototype, \"set\"), _class.prototype), _applyDecoratedDescriptor(_class.prototype, \"setField\", [action], Object.getOwnPropertyDescriptor(_class.prototype, \"setField\"), _class.prototype)), _class);\nexport { Model as default };","map":{"version":3,"sources":["/Users/wpereyra/Documents/Universidad/PP1/look_app_fe/src/lib/Model.js"],"names":["observable","action","computed","toJS","moment","Model","attributes","store","_uriBase","_primaryKey","_store","_error","abilities","_status","set","clone","ModelClass","loggedInUser","appStore","hasOwnProperty","attribute","has","get","error","message","JSON","parse","err","modelDidUpdate","_onUpdateCallback","_lastUpdateAt","diff","updateThreshold","data","undefined","merge","transformData","forEach","value","key","Object","defineProperty","v","afterSetData","field","_callback","isOk","save","destroy","isNew","Map"],"mappings":";;;;;;;;AAAA,SACEA,UADF,EAEEC,MAFF,EAGEC,QAHF,EAIEC,IAAI,IAAJA,KAJF,QAKO,MALP;AAOA,OAAOC,MAAP,MAAmB,QAAnB;IAEqBC,K;;;AAaE;AAErB,iBAAcC,UAAd,EAA0BC,KAA1B,EAAkC;AAAA;;AAAA;;AAAA,SAXlCC,QAWkC,GAXvB,EAWuB;AAAA,SAVlCC,WAUkC,GAVpB,IAUoB;AAAA,SATlCC,MASkC,GATzB,IASyB;AAAA,SARlCC,MAQkC,GARzB,IAQyB;AAAA,SALlCC,SAKkC,GALtB,EAKsB;;AAAA;;AAAA;;AAChC,SAAKF,MAAL,GAAcH,KAAd;AACA,SAAKM,OAAL,GAAe,OAAf;AACA,SAAKC,GAAL,CAASR,UAAT;AACD;AAED;;;;;;;;2BAIQ;AACN,aAAOH,KAAI,CAAC,KAAKG,UAAN,CAAX;AACD;AAED;;;;;;;4BAIS;AAEP;AACA,UAAIS,KAAK,GAAG,IAAIC,UAAJ,CAAe,KAAKb,IAAL,EAAf,EAA6B,KAAKO,MAAlC,CAAZ;AAEAK,MAAAA,KAAK,CAACF,OAAN,GAAgB,KAAKA,OAArB;AAEA,aAAOE,KAAP;AACD;AAED;;;;;;;+BAIY;AACV,aAAO,KAAKZ,IAAL,EAAP;AACD;;;8BAGS;AACR,aAAO,KAAKU,OAAL,IAAgB,OAAhB,IAA2B,KAAKA,OAAL,IAAgB,YAAlD;AACD;;;6BAEQ;AACP,aAAO,KAAKA,OAAL,IAAgB,MAAhB,IAA0B,KAAKA,OAAL,IAAgB,YAAjD;AACD;;;2BAEM;AACL,aAAO,KAAKA,OAAL,IAAgB,IAAvB;AACD;;;8BAES;AACR,aAAO,KAAKA,OAAL,IAAgB,OAAvB;AACD;;;0BAEKZ,M,EAAQ;AACZ,UAAIgB,YAAY,GAAG,IAAnB;;AAEA,UAAK,KAAKP,MAAL,CAAYQ,QAAjB,EAA4B;AAC1BD,QAAAA,YAAY,GAAG,KAAKP,MAAL,CAAYQ,QAAZ,CAAqBD,YAApC;AACD;;AAED,UAAK,KAAKL,SAAL,CAAeO,cAAf,CAA8BlB,MAA9B,CAAL,EAA6C;AAC3C,eAAO,KAAKW,SAAL,CAAeX,MAAf,EAAuBgB,YAAvB,CAAP;AACD;;AAED,aAAO,IAAP;AACD;;;wBAaIG,S,EAAW;AACd,aAAO,KAAKd,UAAL,CAAgBe,GAAhB,CAAoBD,SAApB,CAAP;AACD;;;wBAQIA,S,EAAW;AACd,UAAI,KAAKd,UAAL,CAAgBe,GAAhB,CAAoBD,SAApB,CAAJ,EAAoC;AAClC,eAAO,KAAKd,UAAL,CAAgBgB,GAAhB,CAAoBF,SAApB,CAAP;AACD;;AAED,aAAO,IAAP;AACD;;;kCAca;AACZ,WAAKP,OAAL,GAAe,KAAKA,OAAL,KAAiB,OAAjB,GAA2B,YAA3B,GAA0C,MAAzD;AACD;;;8BAGSU,K,EAAO;AACf,UAAKA,KAAL,EAAa;AAEX,YAAI;AACF,eAAKZ,MAAL,GAAeY,KAAK,CAACC,OAAN,GAAgBC,IAAI,CAACC,KAAL,CAAWH,KAAK,CAACC,OAAjB,EAA0B,QAA1B,CAAhB,GAAsDD,KAArE;AACA,eAAKV,OAAL,GAAe,OAAf;AACD,SAHD,CAIA,OAAOc,GAAP,EAAY;AACV,eAAKhB,MAAL,GAAcY,KAAd;AACA,eAAKV,OAAL,GAAe,OAAf;AACD;;AACD,aAAKA,OAAL,GAAe,OAAf;AACA,aAAKe,cAAL;AACD,OAZD,MAaK;AACH,aAAKf,OAAL,GAAe,IAAf;AACA,aAAKe,cAAL;AACD;;AAED,UAAK,KAAKC,iBAAV,EAA8B;AAC5B,aAAKA,iBAAL,CAAuB,IAAvB,EAA6BN,KAA7B;;AACA,aAAKM,iBAAL,GAAyB,IAAzB;AACD;;AAED,WAAKC,aAAL,GAAqB1B,MAAM,EAA3B;AACD;;;kCAEa;AACZ,UAAK,KAAKS,OAAL,IAAgB,MAArB,EAA8B,OAAO,KAAP;AAE9B,aAAO,KAAKA,OAAL,IAAgB,OAAhB,IAA2BT,MAAM,GAAG2B,IAAT,CAAe,KAAKD,aAApB,EAAmC,SAAnC,IAAiD,KAAKpB,MAAL,CAAYsB,eAA/F,CAHY,CAGoG;AACjH;;;kCAEaC,I,EAAM;AAClB,UAAGA,IAAI,KAAKC,SAAT,IAAsBD,IAAI,CAAC3B,UAAL,KAAoB4B,SAA7C,EAAuD;AACrD,eAAOD,IAAI,CAAC3B,UAAZ;AACD;;AACD,aAAO2B,IAAP;AACD;;;mCAGc,CAAE;;;wBAGZA,I,EAAM;AAAA;;AAET,WAAK3B,UAAL,CAAgB6B,KAAhB,CAAsB,KAAKC,aAAL,CAAmBH,IAAnB,CAAtB;AAEA,WAAK3B,UAAL,CAAgB+B,OAAhB,CAAyB,UAACC,KAAD,EAAQC,GAAR,EAAgB;AAAE,YAAI,KAAI,CAACA,GAAD,CAAJ,KAAcL,SAAlB,EAA8BM,MAAM,CAACC,cAAP,CAAsB,KAAtB,EAA4BF,GAA5B,EAAiC;AACtGzB,UAAAA,GAAG,EAAE,aAAC4B,CAAD;AAAA,mBAAO,KAAI,CAACpC,UAAL,CAAgBQ,GAAhB,CAAoByB,GAApB,EAAyBG,CAAzB,CAAP;AAAA,WADiG;AAEtGpB,UAAAA,GAAG,EAAE,aAACoB,CAAD;AAAA,mBAAO,KAAI,CAACpB,GAAL,CAASiB,GAAT,CAAP;AAAA;AAFiG,SAAjC;AAGpE,OAHL;AAKA,WAAKI,YAAL;AAEA,WAAKb,aAAL,GAAqB1B,MAAM,EAA3B;AACD;;;6BAGSwC,K,EAAOX,I,EAAM;AAAA;;AACrB,WAAK3B,UAAL,CAAgBQ,GAAhB,CAAqB8B,KAArB,EAA4BX,IAA5B;AAEA,WAAKH,aAAL,GAAqB1B,MAAM,EAA3B;AAEAoC,MAAAA,MAAM,CAACC,cAAP,CAAsB,IAAtB,EAA4BG,KAA5B,EAAmC;AAC/B9B,QAAAA,GAAG,EAAE,aAAC4B,CAAD;AAAA,iBAAO,MAAI,CAACpC,UAAL,CAAgBQ,GAAhB,CAAoB8B,KAApB,EAA2BF,CAA3B,CAAP;AAAA,SAD0B;AAE/BpB,QAAAA,GAAG,EAAE,aAACoB,CAAD;AAAA,iBAAO,MAAI,CAACpB,GAAL,CAASsB,KAAT,CAAP;AAAA;AAF0B,OAAnC;AAID;;;qCAGgB,CAAE;;;4BAEVC,S,EAAY;AAEnB,UAAK,KAAKC,IAAL,EAAL,EAAmB;AACjBD,QAAAA,SAAS,IAAIA,SAAS,CAAC,IAAD,CAAtB;AACA,eAAO,IAAP;AACD;;AAED,WAAKhB,iBAAL,GAAyBgB,SAAzB;AAEA,aAAO,IAAP;AACD;;;2BAEM;AACL,aAAO,KAAKnC,MAAL,CAAYqC,IAAZ,CAAiB,IAAjB,CAAP;AACD;;;8BAEQ;AACP,aAAO,KAAKrC,MAAL,CAAYsC,OAAZ,CAAoB,IAApB,CAAP;AACD;;;wBAvIe;AACd,UAAI,KAAKC,KAAT,EAAgB;AACd,eAAO,KAAKzC,QAAZ;AACD,OAFD,MAGK;AACH,yBAAU,KAAKA,QAAf,cAA2B,KAAKc,GAAL,CAAS,KAAKb,WAAd,CAA3B;AACD;AACF;;;wBAOY;AACX,aAAO,CAAC,KAAKY,GAAL,CAAS,KAAKZ,WAAd,CAAR;AACD;;;wBAYS;AACR,aAAO,KAAKY,GAAL,CAAS,KAAKZ,WAAd,IACH,KAAKa,GAAL,CAAS,KAAKb,WAAd,CADG,GAEH,IAFJ;AAGD;;;wBAEc;AACb,aAAO,KAAKC,MAAL,CAAYQ,QAAnB;AACD;;;;+EAtHAlB,U;;;;;WAAwB,IAAIkD,GAAJ,E;;iFAUxBlD,U;;;;;2EACAA,U;;;;;6DAsEAE,Q,2IAcAA,Q,8IAyBAD,M,kJAKAA,M,mJAyCAA,M,6IAGAA,M,yIAeAA,M;SA1LkBI,K","sourcesContent":["import {\n  observable,\n  action,\n  computed,\n  toJS\n} from 'mobx'\n\nimport moment from 'moment';\n\nexport default class Model {\n\n  @observable attributes = new Map();\n\n  _uriBase = '';\n  _primaryKey = 'id';\n  _store = null;\n  _error = null;\n  _onUpdateCallback;\n\n  abilities = {};\n\n  @observable _lastUpdateAt;\n  @observable _status; // empty | first-load | busy | ok | error\n\n  constructor ( attributes, store ) {\n    this._store = store;\n    this._status = 'empty';\n    this.set(attributes);\n  }\n\n  /**\n   * Model shallow serialization \n   *\n   */\n  toJS () {\n    return toJS(this.attributes);\n  }\n\n  /**\n   * Returns a dettached copy from the store collection\n   *\n   */\n  clone () {\n\n    //let ModelClass = this._store.model;\n    let clone = new ModelClass(this.toJS(),  this._store);\n\n    clone._status = this._status;\n\n    return clone;    \n  }\n\n  /**\n   * Model serialization for REST operations \n   *\n   */\n  toParams () {\n    return this.toJS();\n  }\n\n\n  isEmpty() {\n    return this._status == 'empty' || this._status == 'first-load';\n  }\n\n  isBusy() {\n    return this._status == 'busy' || this._status == 'first-load';\n  }\n\n  isOk() {\n    return this._status == 'ok';\n  }\n\n  isError() {\n    return this._status == 'error';\n  }\n\n  canBe(action) {\n    let loggedInUser = null;\n\n    if ( this._store.appStore ) {\n      loggedInUser = this._store.appStore.loggedInUser;\n    }\n    \n    if ( this.abilities.hasOwnProperty(action) ) {\n      return this.abilities[action](loggedInUser);\n    }\n\n    return true;\n  }\n\n\n  @computed\n  get modelURI () {\n    if (this.isNew) {\n      return this._uriBase;\n    } \n    else {\n      return `${this._uriBase}/${this.get(this._primaryKey)}`;\n    }\n  }\n\n  has (attribute) {\n    return this.attributes.has(attribute)\n  }  \n\n  @computed\n  get isNew () {\n    return !this.has(this._primaryKey)\n  }\n\n\n  get (attribute) {\n    if (this.attributes.has(attribute)) {\n      return this.attributes.get(attribute);\n    }\n    \n    return null;\n  }  \n\n\n  get id () {\n    return this.has(this._primaryKey)\n      ? this.get(this._primaryKey)\n      : null;\n  }\n\n  get appStore() {\n    return this._store.appStore;\n  }\n\n  @action\n  beginUpdate() {\n    this._status = this._status === 'empty' ? 'first-load' : 'busy';\n  }\n\n  @action\n  endUpdate(error) {\n    if ( error ) {\n      \n      try {\n        this._error  = error.message ? JSON.parse(error.message)['errors'] : error;\n        this._status = 'error';\n      } \n      catch (err) {\n        this._error = error\n        this._status = 'error';\n      }\n      this._status = 'error'; \n      this.modelDidUpdate();\n    }\n    else {\n      this._status = 'ok';\n      this.modelDidUpdate();  \n    }\n\n    if ( this._onUpdateCallback ) {\n      this._onUpdateCallback(this, error);\n      this._onUpdateCallback = null;\n    }    \n\n    this._lastUpdateAt = moment();\n  }\n\n  needsUpdate() {\n    if ( this._status == 'busy' ) return false;\n\n    return this._status == 'empty' || moment().diff( this._lastUpdateAt, 'minutes' ) > this._store.updateThreshold; // this should be parametrized\n  }  \n\n  transformData(data) {\n    if(data !== undefined && data.attributes !== undefined){\n      return data.attributes;\n    }\n    return data;\n  }\n\n  @action\n  afterSetData() {}\n\n  @action\n  set (data) {\n\n    this.attributes.merge(this.transformData(data));\n\n    this.attributes.forEach( (value, key) => { if( this[key] === undefined ) Object.defineProperty(this, key, { \n        set: (v) => this.attributes.set(key, v),\n        get: (v) => this.get(key),\n      })} );\n\n    this.afterSetData();\n\n    this._lastUpdateAt = moment();\n  }\n\n  @action \n  setField (field, data) {\n    this.attributes.set( field, data );\n\n    this._lastUpdateAt = moment();\n\n    Object.defineProperty(this, field, { \n        set: (v) => this.attributes.set(field, v),\n        get: (v) => this.get(field),\n      });\n  }\n\n\n  modelDidUpdate() {}\n\n  andThen( _callback ) {\n\n    if ( this.isOk() ) {\n      _callback && _callback(this);\n      return this;\n    }\n\n    this._onUpdateCallback = _callback;\n\n    return this;\n  }\n\n  save() {\n    return this._store.save(this);\n  }\n\n  delete() {\n    return this._store.destroy(this);\n  }\n\n}\n"]},"metadata":{},"sourceType":"module"}